// 設定専用データベーススキーマ
// メインDBと分離して耐障害性を向上

generator settingsClient {
  provider = "prisma-client-js"
  output   = "./generated/settings"
}

datasource settingsDb {
  provider = "sqlite"
  url      = "file:./settings.db"
}

// チャプター自動スキップルール
model ChapterSkipRule {
  id        String   @id @default(cuid())
  pattern   String   // スキップするチャプター名のパターン（部分一致）
  enabled   Boolean  @default(true) // 有効/無効切り替え
  userId    String?  // 将来のマルチユーザー対応用（現在は未使用）
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("chapter_skip_rules")
  @@index([enabled])
  @@index([pattern])
}

// 将来の設定項目拡張用
model UserSettings {
  id                    String   @id @default("user_settings") // 単一レコード
  chapterSkipEnabled    Boolean  @default(true) // チャプタースキップ機能全体の有効/無効
  skipNotificationShow  Boolean  @default(true) // スキップ通知表示
  updatedAt            DateTime @updatedAt

  @@map("user_settings")
}

// スキャン設定
model ScanSettings {
  id                        String   @id @default("scan_settings")
  // "lightweight" | "full"
  scanMode                  String   @default("lightweight")
  batchSize                 Int      @default(50)
  progressUpdateInterval    Int      @default(100)
  sleepInterval             Int      @default(1)
  processingPriority        String   @default("normal") // "low" | "normal" | "high"
  maxConcurrentOperations   Int      @default(4)
  memoryThresholdMB         Int      @default(1024)
  autoPauseOnHighCPU        Boolean  @default(false)
  autoPauseThreshold        Int      @default(80)
  autoPauseStartHour        Int      @default(9)
  autoPauseEndHour          Int      @default(18)
  enableDetailedLogging     Boolean  @default(false)
  enableResourceMonitoring  Boolean  @default(true)
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt

  @@map("scan_settings")
}

// スキャンスケジュール設定
model ScanScheduleSettings {
  id                        String   @id @default("scan_schedule_settings")
  enabled                   Boolean  @default(false)
  cronPattern               String?
  interval                  String   @default("weekly") // "daily" | "weekly" | "monthly" | "custom"
  intervalHours             Int      @default(168)
  executionTimeHour         Int      @default(3)
  executionTimeMinute       Int      @default(0)
  weeklyDays                String   @default("[0]") // JSON array of numbers
  monthlyDay                Int      @default(1)
  skipIfRunning             Boolean  @default(true)
  maxExecutionTimeMinutes   Int      @default(180)
  onlyWhenIdle              Boolean  @default(false)
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt

  @@map("scan_schedule_settings")
}
